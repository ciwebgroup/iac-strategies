# =============================================================================
# REDIS SENTINEL CONFIGURATION
# =============================================================================
# High Availability for Redis Master/Replica
# =============================================================================

# Sentinel port
port 26379

# Working directory
dir /tmp

# Monitor the master Redis instance
sentinel monitor mymaster redis-master 6379 2

# Authentication
sentinel auth-pass mymaster ${REDIS_PASSWORD}

# How long (in milliseconds) to consider master down
sentinel down-after-milliseconds mymaster 5000

# How many replicas can be reconfigured at once during failover
sentinel parallel-syncs mymaster 1

# Failover timeout
sentinel failover-timeout mymaster 60000

# Notification scripts (optional)
# sentinel notification-script mymaster /path/to/notify.sh
# sentinel client-reconfig-script mymaster /path/to/reconfig.sh

# Deny dangerous commands
sentinel deny-scripts-reconfig yes

# Log level
loglevel notice

# =============================================================================
# NOTES
# =============================================================================
#
# Quorum Explanation:
# - quorum=2 means 2 sentinels must agree master is down
# - With 3 sentinels: Can tolerate 1 sentinel failure
# - Formula: (N/2) + 1 where N = number of sentinels
#
# Failover Process:
# 1. Sentinels detect master down (after 5s)
# 2. Sentinels vote (need 2/3 to agree)
# 3. Sentinels elect new master from replicas
# 4. Sentinels reconfigure replicas to point to new master
# 5. Sentinel updates clients with new master address
# 
# Total failover time: ~10-15 seconds
#
# Testing Failover:
# 1. Stop master: docker stop <redis-master-container>
# 2. Watch sentinels: redis-cli -p 26379 sentinel master mymaster
# 3. Verify new master elected
# 4. Restart old master (becomes replica)
#
# =============================================================================

